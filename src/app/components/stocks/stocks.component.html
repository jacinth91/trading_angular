<div class="stocks-container">
  <header class="stocks-header">
    <div class="header-content">
      <div class="header-left">
        <button class="back-button" (click)="goBack()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Back</span>
        </button>
        <div class="logo-section">
          <svg width="40" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="48" height="48" rx="8" fill="#D4AF37"/>
            <path d="M24 12L32 20H28V32H20V20H16L24 12Z" fill="white"/>
            <path d="M16 34H32V36H16V34Z" fill="white"/>
          </svg>
          <span class="company-name">UAE Trading</span>
        </div>
      </div>
      <div class="user-section">
        <div class="user-info">
          <div class="user-avatar">{{ username().charAt(0).toUpperCase() }}</div>
          <span class="username">{{ username() }}</span>
        </div>
        <button class="logout-button" (click)="logout()">Sign Out</button>
      </div>
    </div>
  </header>

  <main class="stocks-main">
    <div class="page-header">
      <h1>Available Stocks</h1>
      <p>Browse and select stocks from UAE markets</p>
    </div>

    <div class="search-section">
      <div class="search-box">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input
          type="text"
          placeholder="Search by symbol, name, or sector..."
          [value]="searchQuery()"
          (input)="onSearchChange($any($event.target).value)"
        />
      </div>
    </div>

    <div *ngIf="isLoading()" class="loading-state">
      <div class="spinner-large"></div>
      <p>Loading stocks...</p>
    </div>

    <div *ngIf="!isLoading() && filteredStocks().length === 0" class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h3>No stocks found</h3>
      <p>Try adjusting your search criteria</p>
    </div>

    <div *ngIf="!isLoading() && filteredStocks().length > 0" class="stocks-grid">
      <div
        *ngFor="let stock of filteredStocks()"
        class="stock-card"
      >
        <div class="stock-header" (click)="selectStock(stock)">
          <div>
            <h3 class="stock-symbol">{{ stock.symbol }}</h3>
            <p class="stock-name">{{ stock.name }}</p>
          </div>
          <div class="stock-price">
            <span class="price">AED {{ stock.current_price }}</span>
            <span
              class="change"
              [class.positive]="stock.change_percent > 0"
              [class.negative]="stock.change_percent < 0"
            >
              {{ stock.change_percent > 0 ? '+' : '' }}{{ stock.change_percent }}%
            </span>
          </div>
        </div>
        <div class="stock-details" (click)="selectStock(stock)">
          <div class="detail-item">
            <span class="label">Market:</span>
            <span class="value">{{ stock.market }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Sector:</span>
            <span class="value">{{ stock.sector }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Volume:</span>
            <span class="value">{{ (stock.volume / 1000000).toFixed(2) }}M</span>
          </div>
          <div class="detail-item">
            <span class="label">Market Cap:</span>
            <span class="value">{{ (stock.market_cap / 1000000000).toFixed(2) }}B AED</span>
          </div>
        </div>
        <div class="stock-actions">
          <button class="buy-button" (click)="buyStock(stock, $event)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Buy Stock
          </button>
          <button class="info-button" (click)="selectStock(stock)">
            View Details
          </button>
        </div>
      </div>
    </div>
  </main>

  <div *ngIf="selectedStock()" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <button class="close-button" (click)="closeModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <div class="modal-header">
        <div>
          <h2>{{ selectedStock()!.symbol }}</h2>
          <p class="modal-name">{{ selectedStock()!.name }}</p>
        </div>
        <div class="modal-price">
          <span class="price-large">AED {{ selectedStock()!.current_price }}</span>
          <span
            class="change-large"
            [class.positive]="selectedStock()!.change_percent > 0"
            [class.negative]="selectedStock()!.change_percent < 0"
          >
            {{ selectedStock()!.change_percent > 0 ? '+' : '' }}{{ selectedStock()!.change_percent }}%
          </span>
        </div>
      </div>

      <div class="modal-details">
        <div class="detail-row">
          <span class="detail-label">Market Exchange</span>
          <span class="detail-value">{{ selectedStock()!.market }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Sector</span>
          <span class="detail-value">{{ selectedStock()!.sector }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Trading Volume</span>
          <span class="detail-value">{{ selectedStock()!.volume.toLocaleString() }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Market Capitalization</span>
          <span class="detail-value">{{ (selectedStock()!.market_cap / 1000000000).toFixed(2) }} Billion AED</span>
        </div>
      </div>

      <div class="modal-actions">
        <button class="action-btn buy-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Buy Stock
        </button>
        <button class="action-btn sell-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Sell Stock
        </button>
      </div>
    </div>
  </div>
</div>
