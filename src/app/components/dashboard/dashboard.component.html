<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo-section">
        <svg width="40" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="48" height="48" rx="8" fill="#D4AF37"/>
          <path d="M24 12L32 20H28V32H20V20H16L24 12Z" fill="white"/>
          <path d="M16 34H32V36H16V34Z" fill="white"/>
        </svg>
        <span class="company-name">UAE Trading</span>
      </div>
      <div class="user-section">
        <div class="user-info">
          <div class="user-avatar">{{ username.charAt(0).toUpperCase() }}</div>
          <span class="username">{{ username }}</span>
        </div>
        <button class="logout-button" (click)="logout()">Sign Out</button>
      </div>
    </div>
  </header>

  <main class="dashboard-main">
    <div class="welcome-section">
      <div class="welcome-content">
        <div>
          <h1>Welcome back, {{ username }}!</h1>
          <p>Your trading dashboard is ready</p>
        </div>
        <button class="new-trade-button" (click)="navigateToStocks()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13 7H11V11H7V13H11V17H13V13H17V11H13V7Z" fill="currentColor"/>
            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z" fill="currentColor"/>
          </svg>
          New Trade
        </button>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon" style="background: #e8f5e9;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13 7H11V11H7V13H11V17H13V13H17V11H13V7Z" fill="#4caf50"/>
            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z" fill="#4caf50"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3>Active Trades</h3>
          <p class="stat-value">24</p>
          <p class="stat-change positive">+12% from last week</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: #e3f2fd;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19Z" fill="#2196f3"/>
            <path d="M7 12H9V17H7V12ZM11 10H13V17H11V10ZM15 7H17V17H15V7Z" fill="#2196f3"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3>Portfolio Value</h3>
          <p class="stat-value">AED 2.4M</p>
          <p class="stat-change positive">+8.5% this month</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: #fff3e0;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M16 6L18.29 8.29L13.41 13.17L9.41 9.17L2 16.59L3.41 18L9.41 12L13.41 16L19.71 9.71L22 12V6H16Z" fill="#ff9800"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3>Today's P&L</h3>
          <p class="stat-value">AED 18.5K</p>
          <p class="stat-change positive">+3.2% today</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background: #f3e5f5;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20ZM12.5 7H11V13L16.25 16.15L17 14.92L12.5 12.25V7Z" fill="#9c27b0"/>
          </svg>
        </div>
        <div class="stat-content">
          <h3>Pending Orders</h3>
          <p class="stat-value">8</p>
          <p class="stat-change neutral">Awaiting execution</p>
        </div>
      </div>
    </div>

    <div class="content-grid">
      <div class="data-section">
        <h2>Market Overview</h2>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Symbol</th>
                <th>Name</th>
                <th class="text-right">Price</th>
                <th class="text-right">Change</th>
                <th class="text-right">Volume</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let stock of marketData">
                <td><strong>{{ stock.symbol }}</strong></td>
                <td>{{ stock.name }}</td>
                <td class="text-right">{{ formatCurrency(stock.price) }}</td>
                <td class="text-right">
                  <span [class.positive]="stock.change > 0" [class.negative]="stock.change < 0">
                    {{ stock.change > 0 ? '+' : '' }}{{ stock.changePercent.toFixed(2) }}%
                  </span>
                </td>
                <td class="text-right">{{ stock.volume }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="data-section">
        <h2>Recent Trades</h2>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Symbol</th>
                <th>Type</th>
                <th class="text-right">Quantity</th>
                <th class="text-right">Total</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let trade of recentTrades">
                <td>{{ trade.id }}</td>
                <td><strong>{{ trade.symbol }}</strong></td>
                <td>
                  <span class="badge" [class.badge-buy]="trade.type === 'BUY'" [class.badge-sell]="trade.type === 'SELL'">
                    {{ trade.type }}
                  </span>
                </td>
                <td class="text-right">{{ trade.quantity }}</td>
                <td class="text-right">{{ formatCurrency(trade.total) }}</td>
                <td>
                  <span class="status" [class.status-completed]="trade.status === 'COMPLETED'"
                        [class.status-pending]="trade.status === 'PENDING'">
                    {{ trade.status }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="data-section full-width">
        <h2>Your Portfolio</h2>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Symbol</th>
                <th>Name</th>
                <th class="text-right">Quantity</th>
                <th class="text-right">Avg Price</th>
                <th class="text-right">Current Price</th>
                <th class="text-right">Total Value</th>
                <th class="text-right">P&L</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of portfolio">
                <td><strong>{{ item.symbol }}</strong></td>
                <td>{{ item.name }}</td>
                <td class="text-right">{{ item.quantity }}</td>
                <td class="text-right">{{ formatCurrency(item.avgPrice) }}</td>
                <td class="text-right">{{ formatCurrency(item.currentPrice) }}</td>
                <td class="text-right"><strong>{{ formatCurrency(item.totalValue) }}</strong></td>
                <td class="text-right">
                  <span [class.positive]="item.profitLoss > 0" [class.negative]="item.profitLoss < 0">
                    {{ formatCurrency(item.profitLoss) }} ({{ item.profitLoss > 0 ? '+' : '' }}{{ item.profitLossPercent.toFixed(2) }}%)
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <div *ngIf="showStocksModal()" class="stocks-modal-overlay" (click)="closeStocksModal()">
    <div class="stocks-modal-content" (click)="$event.stopPropagation()">
      <div class="stocks-modal-header">
        <h2>Available Stocks</h2>
        <button class="close-button" (click)="closeStocksModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <div class="stocks-search-section">
        <div class="search-box">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <input
            type="text"
            placeholder="Search by symbol, name, or sector..."
            [value]="searchQuery()"
            (input)="onSearchChange($any($event.target).value)"
          />
        </div>
      </div>

      <div *ngIf="isLoadingStocks()" class="stocks-loading-state">
        <div class="spinner-large"></div>
        <p>Loading stocks...</p>
      </div>

      <div *ngIf="!isLoadingStocks() && filteredStocks().length === 0" class="stocks-empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h3>No stocks found</h3>
        <p>Try adjusting your search criteria</p>
      </div>

      <div *ngIf="!isLoadingStocks() && filteredStocks().length > 0" class="stocks-grid-modal">
        <div
          *ngFor="let stock of filteredStocks()"
          class="stock-card-modal"
        >
          <div class="stock-header-modal" (click)="selectStock(stock)">
            <div>
              <h3 class="stock-symbol-modal">{{ stock.symbol }}</h3>
              <p class="stock-name-modal">{{ stock.name }}</p>
            </div>
            <div class="stock-price-modal">
              <span class="price-modal">AED {{ stock.current_price }}</span>
              <span
                class="change-modal"
                [class.positive]="stock.change_percent > 0"
                [class.negative]="stock.change_percent < 0"
              >
                {{ stock.change_percent > 0 ? '+' : '' }}{{ stock.change_percent }}%
              </span>
            </div>
          </div>
          <div class="stock-details-modal" (click)="selectStock(stock)">
            <div class="detail-item-modal">
              <span class="label-modal">Market:</span>
              <span class="value-modal">{{ stock.market }}</span>
            </div>
            <div class="detail-item-modal">
              <span class="label-modal">Sector:</span>
              <span class="value-modal">{{ stock.sector }}</span>
            </div>
            <div class="detail-item-modal">
              <span class="label-modal">Volume:</span>
              <span class="value-modal">{{ (stock.volume / 1000000).toFixed(2) }}M</span>
            </div>
            <div class="detail-item-modal">
              <span class="label-modal">Market Cap:</span>
              <span class="value-modal">{{ (stock.market_cap / 1000000000).toFixed(2) }}B AED</span>
            </div>
          </div>
          <div class="stock-actions-modal">
            <button class="buy-button-modal" (click)="buyStock(stock, $event)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Buy Stock
            </button>
            <button class="info-button-modal" (click)="selectStock(stock)">
              View Details
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="selectedStock()" class="stock-detail-overlay" (click)="closeStockDetail()">
    <div class="stock-detail-content" (click)="$event.stopPropagation()">
      <div class="stock-detail-header">
        <div>
          <h2>{{ selectedStock()!.symbol }}</h2>
          <p>{{ selectedStock()!.name }}</p>
        </div>
        <button class="close-button" (click)="closeStockDetail()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <div class="stock-detail-body">
        <div class="detail-section">
          <h3>Price Information</h3>
          <div class="detail-grid">
            <div class="detail-row">
              <span class="detail-label">Current Price:</span>
              <span class="detail-value">AED {{ selectedStock()!.current_price }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Change:</span>
              <span class="detail-value" [class.positive]="selectedStock()!.change_percent > 0" [class.negative]="selectedStock()!.change_percent < 0">
                {{ selectedStock()!.change_percent > 0 ? '+' : '' }}{{ selectedStock()!.change_percent }}%
              </span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Market Information</h3>
          <div class="detail-grid">
            <div class="detail-row">
              <span class="detail-label">Market:</span>
              <span class="detail-value">{{ selectedStock()!.market }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Sector:</span>
              <span class="detail-value">{{ selectedStock()!.sector }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Volume:</span>
              <span class="detail-value">{{ (selectedStock()!.volume / 1000000).toFixed(2) }}M</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Market Cap:</span>
              <span class="detail-value">{{ (selectedStock()!.market_cap / 1000000000).toFixed(2) }}B AED</span>
            </div>
          </div>
        </div>

        <button class="buy-button-detail" (click)="buyStock(selectedStock()!, $event); closeStockDetail()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Buy {{ selectedStock()!.symbol }}
        </button>
      </div>
    </div>
  </div>
</div>
